<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XNPBK7CRGG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XNPBK7CRGG');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy-Preserving Neural Monitoring | ONI Framework</title>
    <meta name="description" content="Interactive visualization of privacy-preserving neural monitoring techniques. Explore differential privacy, federated learning, and secure computation for BCI data.">
    <meta property="og:title" content="Privacy-Preserving Neural Monitoring | ONI Framework">
    <meta property="og:description" content="Interactive visualization of privacy-preserving neural monitoring techniques. Explore differential privacy, federated learning, and secure computation for BCI data.">
    <meta property="og:url" content="https://qinnovate.com/mindloft/visualizations/07-privacy-preserving-monitoring.html">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: rgba(17, 24, 39, 0.95);
            --bg-card: rgba(26, 35, 50, 0.9);
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --accent-green: #10b981;
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #1e293b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .architecture-section {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .privacy-flow {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .privacy-flow h2 {
            font-size: 1.1rem;
            color: var(--accent-cyan);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .flow-step:last-child {
            border-bottom: none;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .step-icon.local { background: rgba(16, 185, 129, 0.2); }
        .step-icon.encrypted { background: rgba(139, 92, 246, 0.2); }
        .step-icon.aggregate { background: rgba(59, 130, 246, 0.2); }
        .step-icon.secure { background: rgba(6, 182, 212, 0.2); }

        .step-content h3 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .step-content p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .what-transmitted {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .what-transmitted h2 {
            font-size: 1.1rem;
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .data-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .data-box {
            padding: 1rem;
            border-radius: 8px;
        }

        .data-box.never {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .data-box.always {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .data-box h4 {
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-box.never h4 { color: var(--accent-red); }
        .data-box.always h4 { color: var(--accent-green); }

        .data-box ul {
            list-style: none;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .data-box li {
            padding: 0.25rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Monitoring Dashboard */
        .dashboard {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-header h2 {
            font-size: 1.1rem;
            color: var(--accent-purple);
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.secure {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .metric-value.high { color: var(--accent-green); }
        .metric-value.medium { color: var(--accent-amber); }
        .metric-value.low { color: var(--accent-red); }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .metric-delta {
            font-size: 0.7rem;
            margin-top: 0.5rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
        }

        .metric-delta.positive {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .metric-delta.negative {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .metric-delta.neutral {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-secondary);
        }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-header h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .chart-legend {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        canvas {
            width: 100% !important;
            height: 200px !important;
        }

        /* Equations Section */
        .equations-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .equations-section h2 {
            font-size: 1.1rem;
            color: var(--accent-amber);
            margin-bottom: 1rem;
        }

        .equation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .equation-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
        }

        .equation-box h4 {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .equation {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 1.1rem;
            color: var(--accent-cyan);
            text-align: center;
            padding: 0.75rem;
            background: rgba(6, 182, 212, 0.1);
            border-radius: 6px;
            margin-bottom: 0.75rem;
        }

        .equation-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Statistical Distribution */
        .distribution-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .distribution-section h2 {
            font-size: 1.1rem;
            color: var(--accent-blue);
            margin-bottom: 1rem;
        }

        .distribution-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        /* Alert Log */
        .alert-log {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.8rem;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-time {
            color: var(--text-muted);
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.7rem;
        }

        .alert-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .alert-dot.info { background: var(--accent-blue); }
        .alert-dot.warning { background: var(--accent-amber); }
        .alert-dot.critical { background: var(--accent-red); }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 1000px) {
            .architecture-section { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: repeat(2, 1fr); }
            .charts-grid { grid-template-columns: 1fr; }
            .equation-grid { grid-template-columns: 1fr; }
            .distribution-grid { grid-template-columns: 1fr; }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: var(--accent-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
            display: inline-block;
            margin-right: 0.5rem;
        }

        /* Privacy Shield Animation */
        .shield-icon {
            position: relative;
        }

        .shield-icon::after {
            content: 'üîí';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 0.6rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîê Privacy-Preserving Neural Monitoring</h1>
            <p>How ONI protects your neural data while enabling security monitoring</p>
        </header>

        <!-- Architecture Section -->
        <div class="architecture-section">
            <div class="privacy-flow">
                <h2>üõ°Ô∏è Zero-Knowledge Architecture</h2>

                <div class="flow-step">
                    <div class="step-icon local">üß†</div>
                    <div class="step-content">
                        <h3>1. Local Processing Only</h3>
                        <p>Raw neural signals are processed entirely on-device. No raw data ever leaves.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-icon encrypted">üìê</div>
                    <div class="step-content">
                        <h3>2. Mathematical Reduction</h3>
                        <p>Signals are reduced to variance components (œÉ¬≤œÜ, œÉ¬≤œÑ, œÉ¬≤Œ≥) ‚Äî irreversible transformation.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-icon aggregate">üìä</div>
                    <div class="step-content">
                        <h3>3. Score Transmission</h3>
                        <p>Only C‚Çõ scores, deltas (Œî), and deviations (œÉ) are transmitted ‚Äî no signal reconstruction possible.</p>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-icon secure">ü§ñ</div>
                    <div class="step-content">
                        <h3>4. Federated AI Training</h3>
                        <p>Models train locally. Only encrypted gradients shared. Your patterns never leave your device.</p>
                    </div>
                </div>
            </div>

            <div class="what-transmitted">
                <h2>üîç What TARA Actually Sees</h2>
                <div class="data-comparison">
                    <div class="data-box never">
                        <h4>‚ùå NEVER Transmitted</h4>
                        <ul>
                            <li>‚Ä¢ Raw neural waveforms</li>
                            <li>‚Ä¢ Decoded thoughts/intentions</li>
                            <li>‚Ä¢ ERP components (P300, N170)</li>
                            <li>‚Ä¢ Identifiable spike patterns</li>
                            <li>‚Ä¢ Memory-associated signals</li>
                            <li>‚Ä¢ Emotional state indicators</li>
                            <li>‚Ä¢ Biometric signatures</li>
                            <li>‚Ä¢ Frequency-domain raw data</li>
                        </ul>
                    </div>
                    <div class="data-box always">
                        <h4>‚úì Only These Metrics</h4>
                        <ul>
                            <li>‚Ä¢ C‚Çõ coherence score (0-1)</li>
                            <li>‚Ä¢ Œî delta (rate of change)</li>
                            <li>‚Ä¢ œÉ standard deviation</li>
                            <li>‚Ä¢ Threshold breach flags</li>
                            <li>‚Ä¢ Anomaly severity (1-5)</li>
                            <li>‚Ä¢ Time windows (binned)</li>
                            <li>‚Ä¢ Alert categories</li>
                            <li>‚Ä¢ Aggregate statistics</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid rgba(139, 92, 246, 0.3);">
                    <p style="font-size: 0.85rem; color: var(--accent-purple);">
                        <strong>Key Insight:</strong> C‚Çõ is a one-way mathematical transformation.
                        You cannot reconstruct the original neural signal from the coherence score ‚Äî
                        it's like knowing someone's heart rate without knowing their thoughts.
                    </p>
                </div>
            </div>
        </div>

        <!-- Live Monitoring Dashboard -->
        <div class="dashboard">
            <div class="dashboard-header">
                <h2><span class="live-indicator"></span> Live Privacy-Preserving Dashboard (Simulated)</h2>
                <span class="status-badge secure">üîí Zero Raw Data Exposed</span>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value high" id="cs-value">0.847</div>
                    <div class="metric-label">Coherence Score (C‚Çõ)</div>
                    <div class="metric-delta positive" id="cs-delta">‚ñ≤ +0.012</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="delta-value" style="color: var(--accent-cyan);">0.023</div>
                    <div class="metric-label">Delta (Œî) Rate of Change</div>
                    <div class="metric-delta neutral" id="delta-delta">‚Äî stable</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="sigma-value" style="color: var(--accent-purple);">0.089</div>
                    <div class="metric-label">Deviation (œÉ) from Baseline</div>
                    <div class="metric-delta positive" id="sigma-delta">‚ñº -0.004</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value high" id="privacy-value">100%</div>
                    <div class="metric-label">Privacy Preserved</div>
                    <div class="metric-delta positive">No raw data exposed</div>
                </div>
            </div>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Coherence Score (C‚Çõ) Over Time ‚Äî What TARA Sees</h3>
                        <div class="chart-legend">
                            <span class="legend-item"><span class="legend-dot" style="background: var(--accent-cyan);"></span> C‚Çõ Score</span>
                            <span class="legend-item"><span class="legend-dot" style="background: var(--accent-amber);"></span> Threshold (0.6)</span>
                            <span class="legend-item"><span class="legend-dot" style="background: var(--accent-red);"></span> Critical (0.3)</span>
                        </div>
                    </div>
                    <canvas id="coherenceChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Recent Alerts (Scores Only)</h3>
                    </div>
                    <div class="alert-log" id="alertLog">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Mathematical Foundation -->
        <div class="equations-section">
            <h2>üìê Mathematical Foundation ‚Äî The Irreversible Transformation</h2>
            <div class="equation-grid">
                <div class="equation-box">
                    <h4>Coherence Score</h4>
                    <div class="equation">C‚Çõ = e<sup>‚àí(œÉ¬≤œÜ + œÉ¬≤œÑ + œÉ¬≤Œ≥)</sup></div>
                    <p class="equation-desc">
                        Exponential decay based on total variance. High variance ‚Üí low coherence.
                        <strong>One-way function</strong> ‚Äî cannot recover signal from score.
                    </p>
                </div>
                <div class="equation-box">
                    <h4>Delta (Rate of Change)</h4>
                    <div class="equation">Œî = (C‚Çõ‚Çú ‚àí C‚Çõ‚Çú‚Çã‚ÇÅ) / Œît</div>
                    <p class="equation-desc">
                        First derivative of coherence over time. Shows trend direction without revealing signal content.
                    </p>
                </div>
                <div class="equation-box">
                    <h4>Deviation from Baseline</h4>
                    <div class="equation">œÉ = ‚àö[(1/n)Œ£(C‚Çõ·µ¢ ‚àí CÃÑ‚Çõ)¬≤]</div>
                    <p class="equation-desc">
                        Standard deviation of C‚Çõ from personal baseline. Detects anomalies without exposing patterns.
                    </p>
                </div>
            </div>
        </div>

        <!-- Statistical Distribution -->
        <div class="distribution-section">
            <h2>üìä Statistical Distribution ‚Äî Sample Data Demonstration</h2>
            <div class="distribution-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>Variance Components (What's Computed Locally)</h3>
                    </div>
                    <canvas id="varianceChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>C‚Çõ Distribution (What TARA Aggregates)</h3>
                    </div>
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                <p style="font-size: 0.85rem; color: var(--text-secondary);">
                    <strong>How This Works:</strong> The device computes œÉ¬≤œÜ (phase), œÉ¬≤œÑ (transport), and œÉ¬≤Œ≥ (gain)
                    from raw signals locally. These variances are then combined into a single C‚Çõ score via the
                    exponential function. TARA only ever sees the final score ‚Äî the individual variance components
                    and raw signal never leave the device. This is mathematically proven to be non-invertible.
                </p>
            </div>
        </div>

        <!-- Security Considerations -->
        <div class="equations-section" style="border-color: var(--accent-amber);">
            <h2 style="color: var(--accent-amber);">‚ö†Ô∏è Security Consideration: Score Fingerprinting</h2>
            <div style="padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border: 1px solid rgba(245, 158, 11, 0.3); margin-bottom: 1rem;">
                <p style="font-size: 0.9rem; color: var(--text-primary); margin-bottom: 0.75rem;">
                    <strong>Even C‚Çõ scores can be a fingerprint.</strong> Time-series of coherence values may create identifiable patterns unique to each user, enabling:
                </p>
                <ul style="font-size: 0.85rem; color: var(--text-secondary); margin-left: 1.5rem;">
                    <li><strong>Neural Fingerprinting:</strong> Unique variance patterns in how coherence fluctuates</li>
                    <li><strong>Activity Inference:</strong> Sudden drops correlate with specific cognitive states</li>
                    <li><strong>Re-identification:</strong> Matching score patterns across sessions</li>
                </ul>
            </div>
            <div class="equation-grid">
                <div class="equation-box">
                    <h4 style="color: var(--accent-green);">‚úì Differential Privacy</h4>
                    <div class="equation" style="font-size: 0.9rem;">C‚Çõ' = C‚Çõ + Lap(1/Œµ)</div>
                    <p class="equation-desc">Add calibrated Laplacian noise before transmission. Œµ ‚âà 1.0 balances utility and privacy.</p>
                </div>
                <div class="equation-box">
                    <h4 style="color: var(--accent-green);">‚úì Bucketed Transmission</h4>
                    <div class="equation" style="font-size: 0.9rem;">LOW | MED | HIGH</div>
                    <p class="equation-desc">Transmit category instead of exact value: LOW (&lt;0.3), MED (0.3-0.6), HIGH (&gt;0.6).</p>
                </div>
                <div class="equation-box">
                    <h4 style="color: var(--accent-green);">‚úì Temporal Aggregation</h4>
                    <div class="equation" style="font-size: 0.9rem;">CÃÑ‚Çõ = (1/n)Œ£C‚Çõ·µ¢</div>
                    <p class="equation-desc">Transmit windowed averages (30s-5min) instead of individual readings.</p>
                </div>
            </div>
            <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                <p style="font-size: 0.85rem; color: var(--accent-purple);">
                    <strong>Future Implementation (M8):</strong> ONI will implement layered defense: Œµ-differential privacy + temporal aggregation + session pseudonyms.
                    See <a href="https://github.com/qinnovates/mindloft/blob/main/neurosecurity/legacy-core/project/PROJECT_MANAGEMENT.md" style="color: var(--accent-cyan);">PROJECT_MANAGEMENT.md</a> for roadmap.
                </p>
            </div>
        </div>

        <footer>
            <p>ONI Framework ‚Äî Privacy-Preserving Neural Security</p>
            <p><a href="../">‚Üê Back to ONI Hub</a> | <a href="https://github.com/qinnovates/mindloft">GitHub</a></p>
        </footer>
    </div>

    <script>
        // =============================================
        // PRIVACY-PRESERVING MONITORING SIMULATION
        // =============================================

        // Coherence calculation (matches oni-framework implementation)
        function calculateCoherence(phaseVar, transportVar, gainVar) {
            const totalVariance = phaseVar + transportVar + gainVar;
            return Math.exp(-totalVariance);
        }

        // Generate realistic variance components
        function generateVarianceComponents() {
            // Normal operation: low variance
            const basePhase = 0.05 + Math.random() * 0.1;
            const baseTransport = 0.03 + Math.random() * 0.08;
            const baseGain = 0.02 + Math.random() * 0.06;

            // Occasional spikes (anomalies)
            const spike = Math.random() > 0.95 ? Math.random() * 0.3 : 0;

            return {
                phase: basePhase + spike * 0.5,
                transport: baseTransport + spike * 0.3,
                gain: baseGain + spike * 0.2
            };
        }

        // Data storage
        const dataHistory = {
            coherence: [],
            delta: [],
            sigma: [],
            timestamps: [],
            variances: { phase: [], transport: [], gain: [] }
        };

        const maxDataPoints = 60;
        let baseline = 0.85;
        let previousCs = 0.85;

        // Initialize with some data
        for (let i = 0; i < 30; i++) {
            const vars = generateVarianceComponents();
            const cs = calculateCoherence(vars.phase, vars.transport, vars.gain);
            const delta = cs - previousCs;

            dataHistory.coherence.push(cs);
            dataHistory.delta.push(delta);
            dataHistory.timestamps.push(new Date(Date.now() - (30 - i) * 1000));
            dataHistory.variances.phase.push(vars.phase);
            dataHistory.variances.transport.push(vars.transport);
            dataHistory.variances.gain.push(vars.gain);

            previousCs = cs;
        }

        // Calculate running sigma
        function calculateSigma(data) {
            if (data.length < 2) return 0;
            const mean = data.reduce((a, b) => a + b, 0) / data.length;
            const squaredDiffs = data.map(x => Math.pow(x - mean, 2));
            return Math.sqrt(squaredDiffs.reduce((a, b) => a + b, 0) / data.length);
        }

        // Update metrics display
        function updateMetrics() {
            const vars = generateVarianceComponents();
            const cs = calculateCoherence(vars.phase, vars.transport, vars.gain);
            const delta = cs - previousCs;
            const sigma = calculateSigma(dataHistory.coherence.slice(-20));

            // Update data history
            dataHistory.coherence.push(cs);
            dataHistory.delta.push(delta);
            dataHistory.timestamps.push(new Date());
            dataHistory.variances.phase.push(vars.phase);
            dataHistory.variances.transport.push(vars.transport);
            dataHistory.variances.gain.push(vars.gain);

            // Trim to max points
            if (dataHistory.coherence.length > maxDataPoints) {
                dataHistory.coherence.shift();
                dataHistory.delta.shift();
                dataHistory.timestamps.shift();
                dataHistory.variances.phase.shift();
                dataHistory.variances.transport.shift();
                dataHistory.variances.gain.shift();
            }

            // Update display
            const csEl = document.getElementById('cs-value');
            csEl.textContent = cs.toFixed(3);
            csEl.className = 'metric-value ' + (cs > 0.6 ? 'high' : cs > 0.3 ? 'medium' : 'low');

            const deltaEl = document.getElementById('delta-value');
            deltaEl.textContent = delta >= 0 ? '+' + delta.toFixed(4) : delta.toFixed(4);

            const csDeltaEl = document.getElementById('cs-delta');
            if (delta > 0.005) {
                csDeltaEl.textContent = '‚ñ≤ +' + delta.toFixed(3);
                csDeltaEl.className = 'metric-delta positive';
            } else if (delta < -0.005) {
                csDeltaEl.textContent = '‚ñº ' + delta.toFixed(3);
                csDeltaEl.className = 'metric-delta negative';
            } else {
                csDeltaEl.textContent = '‚Äî stable';
                csDeltaEl.className = 'metric-delta neutral';
            }

            document.getElementById('sigma-value').textContent = sigma.toFixed(3);

            previousCs = cs;

            // Add alert if threshold crossed
            if (cs < 0.6) {
                addAlert(cs < 0.3 ? 'critical' : 'warning',
                    `C‚Çõ = ${cs.toFixed(3)} ${cs < 0.3 ? '(Critical threshold)' : '(Warning threshold)'}`);
            }

            updateCharts();
        }

        // Alert system
        const alerts = [];
        function addAlert(level, message) {
            const time = new Date().toLocaleTimeString();
            alerts.unshift({ time, level, message });
            if (alerts.length > 10) alerts.pop();
            renderAlerts();
        }

        function renderAlerts() {
            const container = document.getElementById('alertLog');
            container.innerHTML = alerts.map(a => `
                <div class="alert-item">
                    <span class="alert-time">${a.time}</span>
                    <span class="alert-dot ${a.level}"></span>
                    <span>${a.message}</span>
                </div>
            `).join('');
        }

        // Initialize alerts
        addAlert('info', 'System initialized ‚Äî privacy mode active');
        addAlert('info', 'C‚Çõ = 0.847 ‚Äî Signal coherent');

        // =============================================
        // CHARTS (Simple Canvas Implementation)
        // =============================================

        function drawCoherenceChart() {
            const canvas = document.getElementById('coherenceChart');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = 200 * 2;
            ctx.scale(2, 2);

            const width = rect.width;
            const height = 200;
            const padding = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // Clear
            ctx.fillStyle = 'transparent';
            ctx.fillRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(148, 163, 184, 0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight * i / 5);
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
            }

            // Draw thresholds
            const warningY = padding.top + chartHeight * (1 - 0.6);
            const criticalY = padding.top + chartHeight * (1 - 0.3);

            ctx.strokeStyle = 'rgba(245, 158, 11, 0.5)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(padding.left, warningY);
            ctx.lineTo(width - padding.right, warningY);
            ctx.stroke();

            ctx.strokeStyle = 'rgba(239, 68, 68, 0.5)';
            ctx.beginPath();
            ctx.moveTo(padding.left, criticalY);
            ctx.lineTo(width - padding.right, criticalY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw coherence line
            if (dataHistory.coherence.length > 1) {
                ctx.strokeStyle = '#06b6d4';
                ctx.lineWidth = 2;
                ctx.beginPath();

                dataHistory.coherence.forEach((cs, i) => {
                    const x = padding.left + (chartWidth * i / (maxDataPoints - 1));
                    const y = padding.top + chartHeight * (1 - cs);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Fill area
                ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
                ctx.lineTo(padding.left, padding.top + chartHeight);
                ctx.closePath();
                ctx.fillStyle = 'rgba(6, 182, 212, 0.1)';
                ctx.fill();
            }

            // Y-axis labels
            ctx.fillStyle = '#64748b';
            ctx.font = '10px -apple-system, sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight * i / 5);
                const value = (1 - i / 5).toFixed(1);
                ctx.fillText(value, padding.left - 5, y + 3);
            }
        }

        function drawVarianceChart() {
            const canvas = document.getElementById('varianceChart');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = 200 * 2;
            ctx.scale(2, 2);

            const width = rect.width;
            const height = 200;
            const padding = { top: 20, right: 20, bottom: 30, left: 50 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            ctx.fillStyle = 'transparent';
            ctx.fillRect(0, 0, width, height);

            // Draw stacked area for variance components
            const colors = {
                phase: { stroke: '#3b82f6', fill: 'rgba(59, 130, 246, 0.3)' },
                transport: { stroke: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.3)' },
                gain: { stroke: '#10b981', fill: 'rgba(16, 185, 129, 0.3)' }
            };

            ['gain', 'transport', 'phase'].forEach(component => {
                const data = dataHistory.variances[component];
                if (data.length > 1) {
                    ctx.strokeStyle = colors[component].stroke;
                    ctx.fillStyle = colors[component].fill;
                    ctx.lineWidth = 1.5;
                    ctx.beginPath();

                    data.forEach((v, i) => {
                        const x = padding.left + (chartWidth * i / (maxDataPoints - 1));
                        const y = padding.top + chartHeight * (1 - v * 2); // Scale for visibility
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    });
                    ctx.stroke();
                }
            });

            // Legend
            ctx.font = '10px -apple-system, sans-serif';
            let legendX = padding.left;
            [
                { label: 'œÉ¬≤œÜ Phase', color: '#3b82f6' },
                { label: 'œÉ¬≤œÑ Transport', color: '#8b5cf6' },
                { label: 'œÉ¬≤Œ≥ Gain', color: '#10b981' }
            ].forEach(item => {
                ctx.fillStyle = item.color;
                ctx.fillRect(legendX, height - 15, 10, 10);
                ctx.fillStyle = '#94a3b8';
                ctx.fillText(item.label, legendX + 15, height - 6);
                legendX += 100;
            });
        }

        function drawDistributionChart() {
            const canvas = document.getElementById('distributionChart');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = 200 * 2;
            ctx.scale(2, 2);

            const width = rect.width;
            const height = 200;
            const padding = { top: 20, right: 20, bottom: 30, left: 40 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            ctx.fillStyle = 'transparent';
            ctx.fillRect(0, 0, width, height);

            // Create histogram bins
            const bins = new Array(20).fill(0);
            dataHistory.coherence.forEach(cs => {
                const binIndex = Math.min(19, Math.floor(cs * 20));
                bins[binIndex]++;
            });

            const maxBin = Math.max(...bins, 1);
            const barWidth = chartWidth / bins.length - 2;

            // Draw bars
            bins.forEach((count, i) => {
                const x = padding.left + i * (chartWidth / bins.length) + 1;
                const barHeight = (count / maxBin) * chartHeight;
                const y = padding.top + chartHeight - barHeight;

                const csValue = i / 20;
                if (csValue < 0.3) {
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.6)';
                } else if (csValue < 0.6) {
                    ctx.fillStyle = 'rgba(245, 158, 11, 0.6)';
                } else {
                    ctx.fillStyle = 'rgba(16, 185, 129, 0.6)';
                }

                ctx.fillRect(x, y, barWidth, barHeight);
            });

            // X-axis labels
            ctx.fillStyle = '#64748b';
            ctx.font = '10px -apple-system, sans-serif';
            ctx.textAlign = 'center';
            [0, 0.3, 0.6, 1.0].forEach(v => {
                const x = padding.left + v * chartWidth;
                ctx.fillText(v.toFixed(1), x, height - 10);
            });

            // Label
            ctx.fillText('C‚Çõ Distribution', width / 2, height - 2);
        }

        function updateCharts() {
            drawCoherenceChart();
            drawVarianceChart();
            drawDistributionChart();
        }

        // Initial draw
        updateCharts();

        // Update every second
        setInterval(updateMetrics, 1000);

        // Handle resize
        window.addEventListener('resize', updateCharts);
    </script>
</body>
</html>
